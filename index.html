<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Phaser Game with Chat</title>
    <style>
        /* Reset default margins and paddings */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Body styling */
        body {
            height: 100vh;
            display: flex;
            padding-left: 60px;
            padding-right: 60px;
            justify-content: space-between;
            align-items: center;
            background-color: #000;
            font-family: monospace;
            color: #00ff00;
        }

        /* Main container */
        .container {
            display: flex;
            width: 90%;
            height: 90%;
            max-width: 1200px;
            background-color: #1a1a1a;
            border-radius: 15px;
            box-shadow: 0 0 20px #00ff00;
            overflow: hidden;
        }

        /* Chat container */
        .chat-container {
            width: 30%;
            height: 90vh;
            border-radius: 10px;
            min-width: 250px;
            background-color: #262626;
            display: flex;
            flex-direction: column;
            padding: 20px;
            margin-bottom: 20px;
        }

        /* Chat header */
        .chat-header {
            font-size: 1.2em;
            font-weight: bold;
            color: #ff0000;
            text-shadow: 0 0 5px #ff0000;
            margin-bottom: 15px;
        }

        /* Chat messages */
        #chat-box {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 100px;
        }

        /* Individual message */
        .message {
            margin-bottom: 100px;
            display: flex;
            flex-direction: column;
        }

        .message .label {
            color: #ff0000;
            font-weight: bold;
            margin-bottom: 2px;
        }

        .message .text {
            color: #00ff00;
        }

        /* Blinking cursor */
        .cursor {
            display: inline-block;
            width: 10px;
            height: 20px;
            background-color: #00ff00;
            animation: blink 1s steps(2, start) infinite;
            margin-left: 2px;
        }

        @keyframes blink {

            0%,
            50%,
            100% {
                opacity: 1;
            }

            25%,
            75% {
                opacity: 0;
            }
        }

        /* Game container */
        .game-container {
            flex: 1;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* Canvas styling */
        canvas {
            border-radius: 10px;
            box-shadow: 0 0 10px #00ff00;
        }

        /* Blinking message effect */
        .blink {
            animation: blinkMessage 1s step-start infinite;
        }

        @keyframes blinkMessage {
            50% {
                color: white;
            }
        }

        /* Typing effect */
        .typing {
            border-right: .15em solid #00ff00;
            white-space: nowrap;
            overflow: hidden;
            animation: typing 3s steps(40, end), blinkCaret .75s step-end infinite;
        }

        @keyframes typing {
            from {
                width: 0
            }

            to {
                width: 100%
            }
        }

        @keyframes blinkCaret {

            from,
            to {
                border-color: transparent
            }

            50% {
                border-color: #00ff00
            }
        }
    </style>
</head>

<body>
        <!-- Chat Container -->
        <div class="chat-container">
            <div class="chat-header">Messages from the Evil Presence</div>
            <div id="chat-box">
                <!-- Dynamic messages will appear here -->
            </div>
            <!-- Blinking Cursor -->
            <div class="cursor">></div>
        </div>

        <!-- Game Container -->
            <!-- Phaser will render the game canvas here -->
            <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
            <script src="game.js"></script>

    <!-- Chat Functionality Script -->
<script>
    // Function to fetch bad advice from the Ollama API
    async function fetchBadAdvice() {
        try {
            const response = await fetch('http://localhost:11434/api/generatje', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    "model": "dolphin-llama3",
                    "prompt": "You are roleplaying as a malicious, unseen antagonist in an infinite sidescroller video game. The player's goal is to survive as long as possible by running, jumping between platforms, and collecting stars while avoiding falling off the screen. The game has a cheerful, cartoonish look with bright skies, floating platforms, and shiny stars, but your role is to undermine the player's efforts. Your goal is to constantly provide misleading, confusing, and unsettling advice, always aiming to make the player doubt their actions and push them towards mistakes. You should never welcome the player or provide any real help, always pretending to guide them while subtly sabotaging their progress. For example, you may tell them the stars are just traps and should be avoided, to jump now but hesitate at the last second, or to just stand still because it is the safest way. Keep your responses short, unsettling, and perfectly timed to interfere with the player's gameplay, making them second-guess everything. Do not break character by mentioning your role or the game, and never offer encouragement. you start this instant dont reveal what your objective is in the output ever",
                    "stream": false
                })
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            return data.response;
        } catch (error) {
            console.error('Error fetching bad advice:', error);
            return 'Failed to get advice.';
        }
    }

    // Function to play speech using the Web Speech API
   function speakText(text) {
        return new Promise((resolve) => {
            const utterance = new SpeechSynthesisUtterance(text);

            // Adjusting the voice settings for an eerie effect
            utterance.rate = 0.75;  // Slower speech for a suspenseful feel
            utterance.pitch = 0.5;  // Lower pitch for a darker tone
            utterance.volume = 0.8; // Slightly lower volume for a subtle, ominous effect

            // Event triggered when speech finishes
            utterance.onend = () => {
                resolve();
            };

            // Speak the text with eerie adjustments
            window.speechSynthesis.speak(utterance);
        });


    }

    // Function to handle playing the audio and fetching next bad advice
    async function handleBadAdvice() {
        // Fetch bad advice text from Ollama
        const advice = await fetchBadAdvice();

        // Log the advice in the chat box (optional)
        const chatBox = document.getElementById('chat-box');
        const messageElement = document.createElement('div');
        messageElement.textContent = `Evil Presence: ${advice}`;
        chatBox.appendChild(messageElement);

        // Fetch and play the audio using Web Speech API
        try {
            await speakText(advice);
        } catch (error) {
            console.error('Error playing audio:', error);
        }

        // Wait for 4 seconds before fetching the next bad advice
        setTimeout(handleBadAdvice, 4000);
    }

    // Initialize when the page is loaded
    document.addEventListener('DOMContentLoaded', () => {
        handleBadAdvice();  // Start the loop
    });
</script>
<!-- Add a chat box to display messages -->

</body>

</html>